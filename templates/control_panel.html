<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>УПРАВЛЕНИЕ</title>
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: '#121212',
                        darker: '#0a0a0a',
                        darklight: '#1e1e1e',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #000000;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        body.dark {
            background-color: #121212;
            color: #e5e5e5;
        }
        .dark .dark-bg {
            background-color: #1e1e1e;
            border-color: #333;
        }
        .dark .darker-bg {
            background-color: #0a0a0a;
        }
        .mono {
            font-family: 'IBM Plex Mono', monospace;
        }
        .nav-link {
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            bottom: -2px;
            left: 0;
            background-color: currentColor;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .controller-card {
            transition: all 0.3s ease;
            border: 1px solid #e5e5e5;
        }
        .dark .controller-card {
            border-color: #333;
        }
        .controller-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .dark .controller-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.3);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .controller-frame {
            width: 100%;
            height: 500px;
            border: 1px solid #e5e5e5;
            border-radius: 0.5rem;
        }
        .dark .controller-frame {
            border-color: #333;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .example-button {
            transition: all 0.2s ease;
        }
        .example-button:hover {
            transform: translateY(-1px);
        }
        .file-upload {
            position: relative;
            overflow: hidden;
        }
        .file-upload-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

#terminal-frame-container {
    max-height: 500px;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
}

#terminal-frame-container.hidden {
    max-height: 0;
    opacity: 0;
}

#ttyd-terminal {
    background-color: #1e1e1e;
    border-radius: 0.5rem;
    height: 400px;
    transition: height 0.3s ease;
}

.dark #ttyd-terminal {
    border-color: #333;
}

/* Строгие кнопки */
.btn {
    border-radius: 4px;
    border: 1px solid transparent;
    font-weight: 500;
    font-size: 0.875rem;
    padding: 8px 16px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    height: 40px;
    min-width: 120px;
}

.btn-primary {
    background-color: #1976d2;
    color: white;
    border-color: #1565c0;
}

.btn-primary:hover {
    background-color: #1565c0;
}

.btn-secondary {
    background-color: #424242;
    color: white;
    border-color: #303030;
}

.btn-secondary:hover {
    background-color: #303030;
}

.btn-danger {
    background-color: #d32f2f;
    color: white;
    border-color: #b71c1c;
}

.btn-danger:hover {
    background-color: #b71c1c;
}

.btn-success {
    background-color: #388e3c;
    color: white;
    border-color: #2e7d32;
}

.btn-success:hover {
    background-color: #2e7d32;
}

.btn-warning {
    background-color: #ffa000;
    color: white;
    border-color: #ff8f00;
}

.btn-warning:hover {
    background-color: #ff8f00;
}

.btn-info {
    background-color: #0288d1;
    color: white;
    border-color: #01579b;
}

.btn-info:hover {
    background-color: #01579b;
}

.btn-outline {
    background-color: transparent;
    border: 1px solid #1976d2;
    color: #1976d2;
}

.btn-outline:hover {
    background-color: rgba(25, 118, 210, 0.08);
}

.btn-sm {
    height: 32px;
    padding: 6px 12px;
    font-size: 0.75rem;
    min-width: 80px;
}

.btn-lg {
    height: 48px;
    padding: 12px 24px;
    font-size: 1rem;
    min-width: 160px;
}

.btn-icon {
    width: 40px;
    min-width: 40px;
    padding: 8px;
}

.btn-icon .fas {
    margin-right: 0;
}

.btn .fas {
    margin-right: 8px;
    font-size: 14px;
}

.btn-group {
    display: flex;
    gap: 8px;
}

.btn-group .btn {
    border-radius: 0;
}

.btn-group .btn:first-child {
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
}

.btn-group .btn:last-child {
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
}

/* Темная тема */
.dark .btn-outline {
    border-color: #90caf9;
    color: #90caf9;
}

.dark .btn-outline:hover {
    background-color: rgba(144, 202, 249, 0.08);
}
    </style>
</head>
<body class="dark:bg-dark dark:text-gray-200">
<!-- Navigation -->
<nav class="fixed w-full z-50 py-4 px-6 bg-white bg-opacity-90 dark:bg-black dark:bg-opacity-90 shadow-md">
  <div class="max-w-7xl mx-auto flex justify-between items-center">
    <!-- Логотип -->
    <div class="flex items-center space-x-2">
      <i class="fas fa-network-wired text-xl dark:text-white"></i>
      <a href="/" class="text-xl font-bold text-gray-900 dark:text-white">SDN LABS</a>
    </div>

    <!-- Меню -->
    <div class="hidden md:flex items-center space-x-6">
      

      <!-- Тема -->
      <button id="darkModeToggle" class="w-10 h-5 rounded-full bg-gray-300 dark:bg-gray-600 relative focus:outline-none transition duration-300">
        <div class="absolute left-0 top-0 w-5 h-5 bg-white dark:bg-gray-300 rounded-full shadow transition transform"></div>
      </button>
    </div>

    <!-- Мобильное меню: кнопка -->
    <div class="md:hidden flex items-center space-x-3">
      <button id="darkModeToggleMobile" class="w-10 h-5 rounded-full bg-gray-300 dark:bg-gray-600 relative focus:outline-none transition duration-300">
        <div class="absolute left-0 top-0 w-5 h-5 bg-white dark:bg-gray-300 rounded-full shadow transition transform"></div>
      </button>
      <button id="mobile-menu-button" class="text-gray-800 dark:text-white focus:outline-none">
        <i class="fas fa-bars text-2xl"></i>
      </button>
    </div>
  </div>

  <!-- Мобильное меню: выпадающее -->
  <div id="mobile-menu" class="md:hidden bg-white dark:bg-gray-900 py-4 px-4 space-y-2 transform transition-all origin-top scale-y-0 opacity-0 pointer-events-none">
    <a href="/#home" class="block text-gray-800 dark:text-white hover:text-blue-500">Главная</a>
    <a href="/#labs" class="block text-gray-800 dark:text-white hover:text-blue-500">Лабораторные</a>
    <a href="/#theory" class="block text-gray-800 dark:text-white hover:text-blue-500">Теория</a>
    <a href="/#tools" class="block text-gray-800 dark:text-white hover:text-blue-500">Инструменты</a>
  </div>
</nav>

<!-- Main Content -->
<div class="pt-24 pb-12 px-6 sm:px-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-4 md:mb-0 dark:text-white">Управление SDN-контроллерами</h1>
            <div class="mono text-sm tracking-wider text-gray-600 dark:text-gray-400">ПАНЕЛЬ УПРАВЛЕНИЯ</div>
        </div>

        <div class="controller-card dark-bg rounded-lg p-6">
        <div class="controller-card dark-bg rounded-lg p-6">
    <div class="flex items-center mb-4">
        <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-3">
            <i class="fas fa-server text-gray-700 dark:text-gray-300"></i>
        </div>
        <h3 class="text-xl font-bold dark:text-white">Управление Vagrant</h3>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
        <button onclick="sendCommand('up --no-provision')" class="btn btn-primary">
            <i class="fas fa-play"></i> Запуск VM
        </button>
        <button onclick="sendCommand('halt')" class="btn btn-warning">
            <i class="fas fa-stop"></i> Остановка VM
        </button>
        <button onclick="sendCommand('status')" class="btn btn-secondary">
            <i class="fas fa-info-circle"></i> Статус VM
        </button>
        <button onclick="sendCommand('destroy -f')" class="btn btn-danger">
            <i class="fas fa-trash-alt"></i> Удаление VM
        </button>
    </div>

    <div class="mb-4">
        <label for="customCmd" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Произвольная команда:</label>
        <div class="flex">
            <input type="text" id="customCmd" placeholder="Введите Vagrant-команду" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
            <button onclick="sendCustomCommand()" class="btn btn-primary rounded-l-none">
                <i class="fas fa-terminal"></i> Выполнить
            </button>
        </div>
    </div>

    
</div>

        <!-- VM Selection -->
        <div class="bg-white dark:bg-darklight rounded-lg shadow-md p-6 mb-8 dark-bg">
            <h2 class="text-xl font-semibold mb-4 dark:text-white">Выбор виртуальной машины</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="vm_choice" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Виртуальная машина:</label>
                    <select id="vm_choice" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white">
                        <option value="VM1">VM1 (Контроллеры)</option>
                        <option value="VM2">VM2 (Mininet и Scapy)</option>
                    </select>
                </div>
            </div>
        </div>


        <div class="controller-card dark-bg rounded-lg p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
            <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-3">
                <i class="fas fa-terminal text-gray-700 dark:text-gray-300"></i>
            </div>
            <h3 class="text-xl font-bold dark:text-white">Веб-терминалы</h3>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Левый терминал -->
        <div class="terminal-control-group">
            <h4 class="text-lg font-semibold dark:text-white mb-3">Терминал 1</h4>
            
            <!-- VM Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Выберите VM:</label>
                <select id="terminal-vm-choice-1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800">
                    <option value="VM1">VM1 (Controller)</option>
                    <option value="VM2" selected>VM2 (Mininet)</option>
                </select>
            </div>

            <!-- Port Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Порт:</label>
                <input id="terminal-port-1" type="number" value="8080" 
                       class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800">
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <button onclick="startTtydTerminal(1)" class="btn btn-success">
                    <i class="fas fa-play mr-2"></i> Запустить
                </button>
                <button onclick="stopTtydTerminal(1)" class="btn btn-danger">
                    <i class="fas fa-stop mr-2"></i> Остановить
                </button>
                <button onclick="toggleTerminal(1)" class="col-span-2 btn btn-outline">
                    <i id="toggle-terminal-icon-1" class="fas fa-eye-slash mr-1.5"></i> 
                    <span id="toggle-terminal-text-1">Скрыть</span>
                </button>
            </div>

            <div id="terminal-frame-container-1" class="transition-all duration-300">
                <iframe id="ttyd-terminal-1" class="w-full h-96 border border-gray-300 dark:border-gray-600 rounded-md" 
                        sandbox="allow-same-origin allow-scripts allow-popups allow-forms">
                </iframe>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                    Терминал <span id="current-vm-name-1">VM2</span>. Порт: <span id="current-terminal-port-1">8080</span>
                </p>
            </div>
        </div>

        <!-- Правый терминал -->
        <div class="terminal-control-group">
            <h4 class="text-lg font-semibold dark:text-white mb-3">Терминал 2</h4>
            
            <!-- VM Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Выберите VM:</label>
                <select id="terminal-vm-choice-2" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800">
                    <option value="VM1" selected>VM1 (Controller)</option>
                    <option value="VM2">VM2 (Mininet)</option>
                </select>
            </div>

            <!-- Port Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Порт:</label>
                <input id="terminal-port-2" type="number" value="8081" 
                       class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800">
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <button onclick="startTtydTerminal(2)" class="btn btn-success">
                    <i class="fas fa-play mr-2"></i> Запустить
                </button>
                <button onclick="stopTtydTerminal(2)" class="btn btn-danger">
                    <i class="fas fa-stop mr-2"></i> Остановить
                </button>
                <button onclick="toggleTerminal(2)" class="col-span-2 btn btn-outline">
                    <i id="toggle-terminal-icon-2" class="fas fa-eye-slash mr-1.5"></i> 
                    <span id="toggle-terminal-text-2">Скрыть</span>
                </button>
            </div>

            <div id="terminal-frame-container-2" class="transition-all duration-300">
                <iframe id="ttyd-terminal-2" class="w-full h-96 border border-gray-300 dark:border-gray-600 rounded-md" 
                        sandbox="allow-same-origin allow-scripts allow-popups allow-forms">
                </iframe>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                    Терминал <span id="current-vm-name-2">VM1</span>. Порт: <span id="current-terminal-port-2">8081</span>
                </p>
            </div>
        </div>
    </div>
</div>
        
        <!-- Controller Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- Controller Control -->
            <div class="controller-card dark-bg rounded-lg p-6">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-server text-gray-700 dark:text-gray-300"></i>
                    </div>
                    <h3 class="text-xl font-bold dark:text-white">Управление контроллерами</h3>
                </div>
                
                <div class="mb-4">
                    <label for="controller_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Контроллер:</label>
                    <select id="controller_type" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white">
                        <option value="Opendaylight">OpenDaylight</option>
                        <option value="ONOS">ONOS</option>
                        <option value="Ryu">Ryu</option>
                    </select>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="startController()" class="btn btn-success flex-1">
                        <i class="fas fa-play mr-2"></i> Запустить
                    </button>
                    <button onclick="stopController()" class="btn btn-danger flex-1">
                        <i class="fas fa-stop mr-2"></i> Остановить
                    </button>
                </div>
            </div>

            <!-- Mininet Control -->
            <div class="controller-card dark-bg rounded-lg p-6">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-network-wired text-gray-700 dark:text-gray-300"></i>
                    </div>
                    <h3 class="text-xl font-bold dark:text-white">Управление Mininet</h3>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Команда Mininet:</label>
                    <textarea id="mininet_command" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white" rows="4" placeholder="sudo mn --topo linear,3 --mac --controller=remote,ip=192.168.56.10,port=6633 --switch ovs,protocols=OpenFlow13"></textarea>
                </div>
                
                <div class="flex space-x-3 mb-3">
                    <button onclick="runMininetCommand()" class="btn btn-primary flex-1">
                        <i class="fas fa-terminal mr-2"></i> Выполнить
                    </button>
                    <div class="file-upload btn btn-outline flex-1">
                        <i class="fas fa-upload mr-2"></i> Загрузить
                        <input type="file" id="mininet_file" class="file-upload-input" onchange="uploadMininetFile()">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="loadMininetExample('simple')" class="btn btn-sm btn-outline">
                        <i class="fas fa-project-diagram mr-1.5"></i> Простая
                    </button>
                    <button onclick="loadMininetExample('pingall')" class="btn btn-sm btn-outline">
                        <i class="fas fa-network-wired mr-1.5"></i> Остановка
                    </button>
                    <button onclick="loadMininetExample('iperf')" class="btn btn-sm btn-outline">
                        <i class="fas fa-tachometer-alt mr-1.5"></i> Тест
                    </button>
                    <button onclick="loadMininetExample('cli')" class="btn btn-sm btn-outline">
                        <i class="fas fa-terminal mr-1.5"></i> Консоль
                    </button>
                </div>
            </div>

            <!-- Scapy Control -->
            <div class="controller-card dark-bg rounded-lg p-6">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-code text-gray-700 dark:text-gray-300"></i>
                    </div>
                    <h3 class="text-xl font-bold dark:text-white">Управление Scapy</h3>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Scapy скрипт:</label>
                    <textarea id="scapy_script" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white" rows="4" placeholder="from scapy.all import *&#10;packet = IP(dst='192.168.1.1')/ICMP()&#10;send(packet)"></textarea>
                </div>
                
                <div class="flex space-x-3 mb-3">
                    <button onclick="runScapyScript()" class="btn btn-primary flex-1">
                        <i class="fas fa-code mr-2"></i> Выполнить
                    </button>
                    <div class="file-upload btn btn-outline flex-1">
                        <i class="fas fa-upload mr-2"></i> Загрузить
                        <input type="file" id="scapy_file" class="file-upload-input" onchange="uploadScapyFile()">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="loadScapyExample('ping')" class="btn btn-sm btn-outline">
                        <i class="fas fa-wifi mr-1.5"></i> Ping
                    </button>
                    <button onclick="loadScapyExample('arp')" class="btn btn-sm btn-outline">
                        <i class="fas fa-network-wired mr-1.5"></i> Flood
                    </button>
                    <button onclick="loadScapyExample('flowtable_dos')" class="btn btn-sm btn-outline">
                        <i class="fas fa-search mr-1.5"></i> Port Scan
                    </button>
                    <button onclick="loadScapyExample('dhcp')" class="btn btn-sm btn-outline">
                        <i class="fas fa-address-card mr-1.5"></i> DHCP
                    </button>
                </div>
                
                <div class="mt-4">
                    <label for="host_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Выберите хост Mininet:</label>
                    <select id="host_name" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white">
                        <option value="h1">h1</option>
                        <option value="h2">h2</option>
                        <option value="h3">h3</option>
                        <option value="h4">h4</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Mininet Session Commands -->
        <div class="bg-white dark:bg-darklight rounded-lg shadow-md p-6 mb-8 dark-bg">
            <h2 class="text-xl font-semibold mb-4 dark:text-white">Команды в Mininet сессию</h2>
            
            <div class="mb-4">
                <label for="mininet_command_input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Команда для Mininet (например, pingall, h1 ping h2):</label>
                <textarea id="mininet_command_input" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white" rows="3" placeholder="Введите команду для выполнения в Mininet сессии"></textarea>
            </div>
            
            <div class="flex flex-wrap items-center gap-4 mb-4">
                <div class="flex items-center">
                    <input type="checkbox" id="wait_for_output" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded dark:bg-darklight">
                    <label for="wait_for_output" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Ожидать вывод</label>
                </div>
                <div class="flex items-center">
                    <label for="timeout" class="block text-sm text-gray-700 dark:text-gray-300 mr-2">Таймаут (сек):</label>
                    <input type="number" id="timeout" value="10" min="1" max="60" class="w-16 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white">
                </div>
            </div>
            
            <div class="flex flex-wrap items-center gap-3">
                <button onclick="sendMininetCommand()" class="btn btn-primary">
                    <i class="fas fa-paper-plane mr-2"></i> Отправить команду
                </button>
                
                <div class="flex flex-wrap gap-2">
                    <button onclick="loadMininetSessionExample('pingall')" class="btn btn-sm btn-outline">
                        <i class="fas fa-network-wired mr-1.5"></i> pingall
                    </button>
                    <button onclick="loadMininetSessionExample('h1_ping_h2')" class="btn btn-sm btn-outline">
                        <i class="fas fa-exchange-alt mr-1.5"></i> h1 ping h2
                    </button>
                    <button onclick="loadMininetSessionExample('links')" class="btn btn-sm btn-outline">
                        <i class="fas fa-link mr-1.5"></i> links
                    </button>
                    <button onclick="loadMininetSessionExample('nodes')" class="btn btn-sm btn-outline">
                        <i class="fas fa-sitemap mr-1.5"></i> nodes
                    </button>
                </div>
            </div>
        </div>

        <!-- Controller Interfaces -->
        <div id="controller-section" class="bg-white dark:bg-darklight rounded-lg shadow-md p-6 mb-8 dark-bg" style="display: none;">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold dark:text-white">Веб-интерфейсы контроллеров</h2>
                <button id="refresh-btn" class="btn btn-sm btn-outline" onclick="refreshCurrentTab()">
                    <i class="fas fa-sync-alt mr-1.5"></i> Обновить
                </button>
            </div>
            
            <div id="controller-tabs" class="flex flex-nowrap gap-2 mb-4 overflow-x-auto pb-2"></div>
            
            <div id="controller-frames" class="relative">
                <div id="loading-overlay" class="absolute inset-0 bg-white dark:bg-darklight bg-opacity-90 flex items-center justify-center hidden">
                    <div class="text-center">
                        <i class="fas fa-spinner loading-spinner text-3xl text-blue-500 mb-3"></i>
                        <p class="text-sm dark:text-gray-300">Загрузка интерфейса...</p>
                    </div>
                </div>
                
                <div id="no-controller" class="text-center py-10">
                    <i class="fas fa-network-wired text-4xl text-gray-400 dark:text-gray-500 mb-3"></i>
                    <p class="text-gray-500 dark:text-gray-400">Нет активных контроллеров. Запустите контроллер, чтобы увидеть его интерфейс.</p>
                </div>
            </div>
        </div>


        <div class="controller-card dark-bg rounded-lg p-6">
    <div class="flex items-center mb-4">
        <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mr-3">
            <i class="fab fa-python text-gray-700 dark:text-gray-300"></i>
        </div>
        <h3 class="text-xl font-bold dark:text-white">Управление Python</h3>
    </div>
    
    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Python скрипт:</label>
        <textarea id="python_script" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white" rows="4" placeholder="print('Hello from Python!')\nimport os\nprint(f'Current directory: {os.getcwd()}')"></textarea>
    </div>
    
    <div class="flex space-x-3 mb-3">
        <button onclick="runPythonScript()" class="btn btn-primary flex-1">
            <i class="fas fa-play mr-2"></i> Выполнить
        </button>
        <div class="file-upload btn btn-outline flex-1">
            <i class="fas fa-upload mr-2"></i> Загрузить
            <input type="file" id="python_file" class="file-upload-input" onchange="uploadPythonFile()">
        </div>
    </div>
    
    <div class="grid grid-cols-2 gap-2">
        <button onclick="loadPythonExample('network')" class="btn btn-sm btn-outline">
            <i class="fas fa-network-wired mr-1.5"></i> Сеть
        </button>
        <button onclick="loadPythonExample('files')" class="btn btn-sm btn-outline">
            <i class="fas fa-file-alt mr-1.5"></i> Файлы
        </button>
        <button onclick="loadPythonExample('monitoring')" class="btn btn-sm btn-outline">
            <i class="fas fa-chart-bar mr-1.5"></i> Мониторинг
        </button>
        <button onclick="loadPythonExample('mininet')" class="btn btn-sm btn-outline">
            <i class="fas fa-server mr-1.5"></i> Mininet
        </button>
    </div>
    
    <div class="mt-4">
        <label for="python_host_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Выберите хост Mininet:</label>
        <select id="python_host_name" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-darklight dark:text-white">
            <option value="">На VM напрямую</option>
            <option value="h1">h1</option>
            <option value="h2">h2</option>
            <option value="h3">h3</option>
            <option value="h4">h4</option>
        </select>
    </div>
</div>

        <!-- Output Section -->
        <div class="bg-white dark:bg-darklight rounded-lg shadow-md p-6 dark-bg">
            <h2 class="text-xl font-semibold mb-4 dark:text-white">Результаты выполнения</h2>
            <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-md">
                <pre id="output" class="whitespace-pre-wrap text-gray-800 dark:text-gray-300 text-sm font-mono">Готов к работе. Выберите действие...</pre>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->


<script>
    // Конфигурация контроллеров
    const controllerConfig = {
        "Opendaylight": { 
            url: "http://192.168.56.10:8181/index.html", 
            vm: "VM1",
            name: "OpenDaylight",
            icon: "fas fa-network-wired"
        },
        "ONOS": { 
            url: "http://192.168.56.10:8181/onos/ui?noautofocus", 
            vm: "VM1",
            name: "ONOS",
            icon: "fas fa-server"
        },
        "Ryu": { 
            url: "http://192.168.56.10:8080", 
            vm: "VM1",
            name: "Ryu",
            icon: "fas fa-project-diagram"
        }
    };

    // Примеры Scapy скриптов
    const scapyExamples = {
        ping: `from scapy.all import *

# ===== Настройки =====
src_ip = ""        # IP хоста, с которого отправляем
dst_ip = ""        # IP целевого хоста
interface = ""      # интерфейс, через который отправляем
# ======================

print(f"[+] Выполняем ARP-запрос для {dst_ip}...")

# Формируем ARP-запрос
arp_request = ARP(pdst=dst_ip)
broadcast = Ether(dst="ff:ff:ff:ff:ff:ff")
arp_result = srp(broadcast / arp_request, iface=interface, timeout=2, verbose=False)

# Проверяем, есть ли ответ
if len(arp_result[0]) == 0:
    print(f"[-] Не удалось получить MAC-адрес для {dst_ip}")
    exit(1)

target_mac = arp_result[0][0][1].hwsrc  # правильное обращение к результату
print(f"[+] Найден MAC для {dst_ip}: {target_mac}")

# Формируем Ethernet + IP + ICMP пакет
ether = Ether(src=get_if_hwaddr(interface), dst=target_mac)
ip = IP(src=src_ip, dst=dst_ip)
icmp = ICMP()

packet = ether / ip / icmp

print(f"[+] Отправляем ICMP пакет от {src_ip} к {dst_ip}...")
response = srp1(packet, iface=interface, timeout=2, verbose=False)

if response:
    print("[+] Получен ответ:")
    response.show()
else:
    print("[-] Нет ответа.")`,

            arp: `from scapy.all import *
import random

def generate_random_ip():
    return "10.0.0." + str(random.randint(1, 254))

def flood_flows(target_ip, count=1000):
    for i in range(count):
        src_ip = generate_random_ip()
        pkt = Ether()/IP(src=src_ip, dst=target_ip)/TCP(sport=random.randint(1024,65535), dport=80)
        sendp(pkt, iface="eth0", verbose=0)
        if i % 100 == 0:
            print(f"Sent {i} packets")

if __name__ == "__main__":
    flood_flows("10.0.0.3", 5000) # 10.0.0.3 - адрес сервера`,

            flowtable_dos: `from scapy.all import *
import random

def generate_random_ip():
    return "10.0.0." + str(random.randint(1, 254))

def flood_flows(target_ip, count=1000):
    for i in range(count):
        src_ip = generate_random_ip()
        pkt = Ether()/IP(src=src_ip, dst=target_ip)/TCP(sport=random.randint(1024,65535), dport=80)
        sendp(pkt, iface="eth0", verbose=0)
        if i % 100 == 0:
            print(f"Sent {i} packets")

if __name__ == "__main__":
    flood_flows("10.0.0.3", 5000) # 10.0.0.3 - адрес сервера`,

            dhcp: `from scapy.all import *
# DHCP discovery
conf.checkIPaddr = False
dhcp_discover = Ether(dst="ff:ff:ff:ff:ff:ff")/IP(src="0.0.0.0",dst="255.255.255.255")/UDP(sport=68,dport=67)/BOOTP(chaddr="001122334455")/DHCP(options=[("message-type","discover"),"end"])
ans, unans = srp(dhcp_discover, multi=True, timeout=5)
for packet in ans:
    print(packet[1][DHCP].options)`
    };

    // Примеры команд Mininet
    const mininetExamples = {
        simple: `sudo mn --topo linear,3 --mac --controller=remote,ip=192.168.56.10,port=6633 --switch ovs,protocols=OpenFlow13`,
        pingall: `sudo mn -c`,
        iperf: `sudo mn --controller=remote,ip=192.168.56.10 --topo=linear,4 --test iperf`,
        cli: `sudo mn --controller=remote,ip=192.168.56.10 --topo=tree,depth=2,fanout=3`
    };

    // Примеры команд для Mininet сессии
    const mininetSessionExamples = {
        pingall: "pingall",
        h1_ping_h2: "h1 ping h2",
        links: "links",
        nodes: "nodes",
        dump: "dump",
        net: "net",
        h1_ifconfig: "h1 ifconfig",
        h1_arp: "h1 arp -a"
    };

    // Текущие активные контроллеры
    const activeControllers = new Map();
    let currentActiveTab = null;

    // Общие функции для работы с UI
    function showLoading(message = "Выполнение команды...") {
        const output = document.getElementById('output');
        output.innerHTML = `<div class="text-blue-500"><i class="fas fa-spinner fa-spin mr-2"></i>${message}</div>`;
    }

    function showError(message) {
        const output = document.getElementById('output');
        output.innerHTML = `<div class="text-red-500"><i class="fas fa-exclamation-circle mr-2"></i>${message}</div>`;
    }

    function showSuccess(message) {
        const output = document.getElementById('output');
        output.innerHTML = `<div class="text-green-500"><i class="fas fa-check-circle mr-2"></i>${message}</div>`;
    }

    // Отправка команды в Mininet сессию
    async function sendMininetCommand() {
            const command = document.getElementById('mininet_command_input').value.trim();
            const waitForOutput = document.getElementById('wait_for_output').checked;
            const timeout = document.getElementById('timeout').value;
            
            if (!command) {
                showError("Пожалуйста, введите команду для Mininet");
                return;
            }
            
            showLoading(`Отправка команды в Mininet: ${command}`);
            
            try {
                const formData = new FormData();
                formData.append('command', command);
                formData.append('wait_for_output', waitForOutput);
                formData.append('timeout', timeout);
                
                const response = await fetch('/send_mininet_command', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.text();
                showSuccess(result);
            } catch (error) {
                showError(`Ошибка при отправке команды в Mininet: ${error.message}`);
                console.error('Ошибка:', error);
            }
        }

        // Загрузка примера команды для Mininet сессии
        function loadMininetSessionExample(exampleName) {
            const example = mininetSessionExamples[exampleName];
            if (example) {
                document.getElementById('mininet_command_input').value = example;
            }
        }

    // Управление контроллерами
    async function startController() {
            const vmChoice = document.getElementById('vm_choice').value;
            const controllerType = document.getElementById('controller_type').value;
            
            showLoading(`Запуск ${controllerType}...`);
            
            try {
                const formData = new FormData();
                formData.append('vm_choice', vmChoice);
                formData.append('controller_type', controllerType);
                
                const response = await fetch('/start_controller', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.text();
                showSuccess(result);
                
                // Если контроллер должен отображаться на этой VM
                if (vmChoice === controllerConfig[controllerType]?.vm) {
                    addControllerTab(controllerType);
                }
            } catch (error) {
                showError(`Ошибка при запуске контроллера: ${error.message}`);
                console.error('Ошибка:', error);
            }
        }

    async function stopController() {
            const vmChoice = document.getElementById('vm_choice').value;
            const controllerType = document.getElementById('controller_type').value;
            
            showLoading(`Остановка ${controllerType}...`);
            
            try {
                const formData = new FormData();
                formData.append('vm_choice', vmChoice);
                formData.append('controller_type', controllerType);
                
                const response = await fetch('/stop_controller', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.text();
                showSuccess(result);
                
                removeControllerTab(controllerType);
            } catch (error) {
                showError(`Ошибка при остановке контроллера: ${error.message}`);
                console.error('Ошибка:', error);
            }
        }

    // Управление вкладками контроллеров
    function addControllerTab(controllerType) {
        if (activeControllers.has(controllerType)) return;
        
        const config = controllerConfig[controllerType];
        if (!config) return;
        
        const tabsContainer = document.getElementById('controller-tabs');
        const framesContainer = document.getElementById('controller-frames');
        const controllerSection = document.getElementById('controller-section');
        const noControllerMsg = document.getElementById('no-controller');
        
        // Скрываем сообщение "нет контроллеров"
        if (noControllerMsg) noControllerMsg.style.display = 'none';
        
        // Создаем вкладку
        const tab = document.createElement('button');
        tab.className = 'px-4 py-2 bg-blue-600 text-white rounded-md flex items-center text-sm';
        tab.innerHTML = `<i class="${config.icon} mr-2"></i>${config.name}`;
        tab.dataset.controllerType = controllerType;
        tab.onclick = () => switchControllerTab(controllerType);
        
        // Создаем фрейм
        const frameWrapper = document.createElement('div');
        frameWrapper.className = 'controller-frame-wrapper relative';
        frameWrapper.style.display = 'none';
        
        const frame = document.createElement('iframe');
        frame.id = `frame-${controllerType}`;
        frame.className = 'controller-frame';
        frame.src = config.url;
        frame.loading = "lazy";
        
        // Добавляем обработчик загрузки фрейма
        frame.onload = () => {
            document.getElementById('loading-overlay').classList.add('hidden');
        };
        
        frameWrapper.appendChild(frame);
        
        // Добавляем элементы
        tabsContainer.appendChild(tab);
        framesContainer.insertBefore(frameWrapper, framesContainer.firstChild);
        activeControllers.set(controllerType, frameWrapper);
        
        // Показываем секцию
        if (controllerSection) {
            controllerSection.style.display = 'block';
        }
        
        // Делаем эту вкладку активной
        switchControllerTab(controllerType);
        
        // Показываем индикатор загрузки
        document.getElementById('loading-overlay').classList.remove('hidden');
    }

    function removeControllerTab(controllerType) {
        if (!activeControllers.has(controllerType)) return;
        
        // Удаляем вкладку
        const tabToRemove = document.querySelector(`button[data-controller-type="${controllerType}"]`);
        if (tabToRemove) tabToRemove.remove();
        
        // Удаляем фрейм
        const frameWrapper = activeControllers.get(controllerType);
        if (frameWrapper) frameWrapper.remove();
        
        // Удаляем из активных контроллеров
        activeControllers.delete(controllerType);
        
        // Показываем сообщение "нет контроллеров", если это был последний
        const noControllerMsg = document.getElementById('no-controller');
        if (activeControllers.size === 0 && noControllerMsg) {
            noControllerMsg.style.display = 'block';
            
            // Скрываем секцию, если нет активных контроллеров
            const controllerSection = document.getElementById('controller-section');
            if (controllerSection) {
                controllerSection.style.display = 'none';
            }
        } else if (currentActiveTab === controllerType) {
            // Если удалили активную вкладку, активируем первую доступную
            const firstTab = document.querySelector('[data-controller-type]');
            if (firstTab) {
                switchControllerTab(firstTab.dataset.controllerType);
            }
        }
    }

    function switchControllerTab(controllerType) {
        if (!activeControllers.has(controllerType)) return;
        
        // Обновляем активное состояние вкладок
        document.querySelectorAll('[data-controller-type]').forEach(tab => {
            const isActive = tab.dataset.controllerType === controllerType;
            tab.classList.toggle('bg-blue-600', isActive);
            tab.classList.toggle('bg-gray-200', !isActive);
            tab.classList.toggle('dark:bg-gray-700', !isActive);
            tab.classList.toggle('text-white', isActive);
            tab.classList.toggle('text-gray-700', !isActive);
            tab.classList.toggle('dark:text-gray-300', !isActive);
        });
        
        // Показываем соответствующий фрейм
        activeControllers.forEach((frameWrapper, type) => {
            frameWrapper.style.display = type === controllerType ? 'block' : 'none';
        });
        
        currentActiveTab = controllerType;
    }

    function refreshCurrentTab() {
        if (!currentActiveTab) return;
        
        const frameWrapper = activeControllers.get(currentActiveTab);
        if (!frameWrapper) return;
        
        const frame = frameWrapper.querySelector('iframe');
        if (frame) {
            document.getElementById('loading-overlay').classList.remove('hidden');
            frame.src = frame.src; // Перезагружаем фрейм
        }
    }

    // Управление Mininet
    async function runMininetCommand() {
            const vmChoice = document.getElementById('vm_choice').value;
            const command = document.getElementById('mininet_command').value.trim();
            
            if (vmChoice === "VM1") {
                showError("Mininet доступен только на VM2.");
                return;
            }
            
            if (!command) {
                showError("Пожалуйста, введите команду Mininet");
                return;
            }
            
            showLoading(`Выполнение команды Mininet: ${command}`);
            
            try {
                const formData = new FormData();
                formData.append('vm_choice', vmChoice);
                formData.append('command_type', 'custom');
                formData.append('custom_command', command);
                
                const response = await fetch('/run_mininet', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.text();
                showSuccess(result);
            } catch (error) {
                showError(`Ошибка выполнения команды Mininet: ${error.message}`);
                console.error('Ошибка:', error);
            }
        }

        async function uploadMininetFile() {
            const fileInput = document.getElementById('mininet_file');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            showLoading("Загрузка файла с командой Mininet...");
            
            try {
                const formData = new FormData();
                formData.append('vm_choice', document.getElementById('vm_choice').value);
                formData.append('mininet_file', file);
                
                const response = await fetch('/upload_mininet', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.text();
                showSuccess(result);
            } catch (error) {
                showError(`Ошибка загрузки файла: ${error.message}`);
                console.error('Ошибка:', error);
            }
        }

        function loadMininetExample(exampleName) {
            const example = mininetExamples[exampleName];
            if (example) {
                document.getElementById('mininet_command').value = example;
            }
        }

    // Управление Scapy
     async function runScapyScript() {
    const vmChoice = document.getElementById('vm_choice').value;
    const scapyScript = document.getElementById('scapy_script').value;
    const hostName = document.getElementById('host_name').value;

    if (!scapyScript.trim()) {
        showError("Пожалуйста, введите Scapy скрипт");
        return;
    }

    showLoading("Выполнение Scapy скрипта...");

    try {
        const formData = new FormData();
        formData.append('vm_choice', vmChoice);
        formData.append('scapy_script', scapyScript);
        formData.append('host_name', hostName);  // <-- Добавлено

        const response = await fetch('/run_scapy', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        const result = await response.text();
        showSuccess(result);
    } catch (error) {
        showError(`Ошибка выполнения Scapy скрипта: ${error.message}`);
        console.error('Ошибка:', error);
    }
}


        async function uploadScapyFile() {
            const fileInput = document.getElementById('scapy_file');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            showLoading("Загрузка Scapy файла...");
            
            try {
                const formData = new FormData();
                formData.append('vm_choice', document.getElementById('vm_choice').value);
                formData.append('scapy_file', file);
                
                const response = await fetch('/upload_scapy', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.text();
                showSuccess(result);
            } catch (error) {
                showError(`Ошибка загрузки файла: ${error.message}`);
                console.error('Ошибка:', error);
            }
        }

        function loadScapyExample(exampleName) {
            const example = scapyExamples[exampleName];
            if (example) {
                document.getElementById('scapy_script').value = example;
            }
        }


        const pythonExamples = {
    network: `import socket

# Проверка доступности хоста
def check_host(host, port):
    try:
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            s.settimeout(2)
            s.connect((host, port))
            return True
    except:
        return False

host = "google.com"
port = 80
result = check_host(host, port)
print(f"Хост {host}:{'доступен' if result else 'недоступен'}")`,

    files: `import os
import glob

# Анализ файлов в директории
def analyze_directory(path):
    print(f"Содержимое директории {path}:")
    for item in os.listdir(path):
        full_path = os.path.join(path, item)
        if os.path.isfile(full_path):
            print(f"Файл: {item} ({os.path.getsize(full_path)} байт)")
        elif os.path.isdir(full_path):
            print(f"Директория: {item}")

analyze_directory("/tmp")`,

    monitoring: `import psutil
import time

# Мониторинг ресурсов
def monitor_resources(duration=5):
    print("Мониторинг ресурсов системы:")
    for i in range(duration):
        cpu = psutil.cpu_percent()
        mem = psutil.virtual_memory().percent
        print(f"{i+1}/{duration} - CPU: {cpu}%, MEM: {mem}%")
        time.sleep(1)

monitor_resources()`,

    mininet: `from mininet.cli import CLI
from mininet.log import setLogLevel
from mininet.net import Mininet
from mininet.node import RemoteController
from mininet.topo import SingleSwitchTopo

# Простое подключение к Mininet
def connect_to_mininet():
    setLogLevel('info')
    net = Mininet(topo=SingleSwitchTopo(4), 
                 controller=lambda name: RemoteController(name, ip='192.168.56.10'))
    net.start()
    CLI(net)
    net.stop()

connect_to_mininet()`
};

async function runPythonScript() {
    const vmChoice = document.getElementById('vm_choice').value;
    const pythonScript = document.getElementById('python_script').value;
    const hostName = document.getElementById('python_host_name').value;

    if (!pythonScript.trim()) {
        showError("Пожалуйста, введите Python скрипт");
        return;
    }

    showLoading("Выполнение Python скрипта...");

    try {
        const formData = new FormData();
        formData.append('vm_choice', vmChoice);
        formData.append('python_script', pythonScript);
        formData.append('host_name', hostName);

        const response = await fetch('/run_python_script', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        const result = await response.text();
        showSuccess(result);
    } catch (error) {
        showError(`Ошибка выполнения Python скрипта: ${error.message}`);
        console.error('Ошибка:', error);
    }
}

async function uploadPythonFile() {
    const fileInput = document.getElementById('python_file');
    const file = fileInput.files[0];
    
    if (!file) return;
    
    showLoading("Загрузка Python файла...");
    
    try {
        const formData = new FormData();
        formData.append('vm_choice', document.getElementById('vm_choice').value);
        formData.append('python_file', file);
        formData.append('host_name', document.getElementById('python_host_name').value);
        
        const response = await fetch('/upload_python_script', {
            method: 'POST',
            body: formData
        });
        
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        
        const result = await response.text();
        showSuccess(result);
    } catch (error) {
        showError(`Ошибка загрузки файла: ${error.message}`);
        console.error('Ошибка:', error);
    }
}

function loadPythonExample(exampleName) {
    const example = pythonExamples[exampleName];
    if (example) {
        document.getElementById('python_script').value = example;
    }
}


     async function sendCommand(command) {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = 'Выполняю команду...';
            
            try {
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: command })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                outputDiv.innerHTML = data.success 
                    ? `<span class="success">Успешно:</span>\n${data.output || 'Нет вывода'}` 
                    : `<span class="error">Ошибка:</span>\n${data.error || 'Неизвестная ошибка'}`;
            } catch (error) {
                outputDiv.innerHTML = `<span class="error">Ошибка:</span> ${error.message}`;
            }
        }

        function sendCustomCommand() {
            const cmdInput = document.getElementById("customCmd");
            const cmd = cmdInput.value.trim();
            if (cmd) {
                sendCommand(cmd);
                cmdInput.value = '';
            }
        }

let terminals = {
    terminal1: {
        port: 8080,
        isVisible: true,
        currentVm: "VM2",
        url: ""
    },
    terminal2: {
        port: 8081,
        isVisible: true,
        currentVm: "VM1",
        url: ""
    }
};

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
    // Инициализация первого терминала
    const vmSelect1 = document.getElementById('terminal-vm-choice-1');
    const portInput1 = document.getElementById('terminal-port-1');
    
    vmSelect1.addEventListener('change', function() {
        terminals.terminal1.currentVm = this.value;
        document.getElementById('current-vm-name-1').textContent = this.value;
    });
    
    portInput1.addEventListener('change', function() {
        terminals.terminal1.port = parseInt(this.value) || 8080;
        document.getElementById('current-terminal-port-1').textContent = terminals.terminal1.port;
    });

    // Инициализация второго терминала
    const vmSelect2 = document.getElementById('terminal-vm-choice-2');
    const portInput2 = document.getElementById('terminal-port-2');
    
    vmSelect2.addEventListener('change', function() {
        terminals.terminal2.currentVm = this.value;
        document.getElementById('current-vm-name-2').textContent = this.value;
    });
    
    portInput2.addEventListener('change', function() {
        terminals.terminal2.port = parseInt(this.value) || 8081;
        document.getElementById('current-terminal-port-2').textContent = terminals.terminal2.port;
    });
});

// Переключение видимости терминала
function toggleTerminal(terminalNum) {
    const terminal = terminals[`terminal${terminalNum}`];
    const container = document.getElementById(`terminal-frame-container-${terminalNum}`);
    const icon = document.getElementById(`toggle-terminal-icon-${terminalNum}`);
    const text = document.getElementById(`toggle-terminal-text-${terminalNum}`);
    
    terminal.isVisible = !terminal.isVisible;
    
    if (terminal.isVisible) {
        container.classList.remove('hidden');
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        text.textContent = 'Скрыть';
    } else {
        container.classList.add('hidden');
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        text.textContent = 'Показать';
    }
}

// Запуск терминала
async function startTtydTerminal(terminalNum) {
    const terminal = terminals[`terminal${terminalNum}`];
    const vmChoice = document.getElementById(`terminal-vm-choice-${terminalNum}`).value;
    const port = document.getElementById(`terminal-port-${terminalNum}`).value;
    
    showLoading(`Запуск веб-терминала ${terminalNum} на ${vmChoice}...`);
    
    try {
        const response = await fetch('/start_ttyd', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `vm_choice=${vmChoice}&port=${port}&command=bash`
        });
        
        const result = await response.json();
        
        if (result.success) {
            showSuccess(result.message);
            document.getElementById(`terminal-frame-container-${terminalNum}`).classList.remove('hidden');
            document.getElementById(`ttyd-terminal-${terminalNum}`).src = result.url;
            document.getElementById(`current-terminal-port-${terminalNum}`).textContent = port;
            document.getElementById(`current-vm-name-${terminalNum}`).textContent = vmChoice;
            terminal.isVisible = true;
            terminal.url = result.url;
            terminal.currentVm = vmChoice;
            terminal.port = port;
            
            // Обновляем кнопку видимости
            document.getElementById(`toggle-terminal-icon-${terminalNum}`).className = 'fas fa-eye-slash mr-1.5';
            document.getElementById(`toggle-terminal-text-${terminalNum}`).textContent = 'Скрыть';
        } else {
            showError(result.message || `Не удалось запустить терминал ${terminalNum}`);
        }
    } catch (error) {
        showError(`Ошибка терминала ${terminalNum}: ${error.message}`);
    }
}

// Остановка терминала
async function stopTtydTerminal(terminalNum) {
    const terminal = terminals[`terminal${terminalNum}`];
    const vmChoice = document.getElementById(`terminal-vm-choice-${terminalNum}`).value;
    const port = document.getElementById(`terminal-port-${terminalNum}`).value;
    
    showLoading(`Остановка веб-терминала ${terminalNum} на ${vmChoice}...`);
    
    try {
        const response = await fetch('/stop_ttyd', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `vm_choice=${vmChoice}&port=${port}`
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'Неизвестная ошибка сервера');
        }
        
        const result = await response.json();
        
        if (result.success) {
            showSuccess(result.message);
            document.getElementById(`ttyd-terminal-${terminalNum}`).src = '';
            document.getElementById(`terminal-frame-container-${terminalNum}`).classList.add('hidden');
            terminal.isVisible = false;
            terminal.url = '';
            
            // Обновляем кнопку видимости
            document.getElementById(`toggle-terminal-icon-${terminalNum}`).className = 'fas fa-eye mr-1.5';
            document.getElementById(`toggle-terminal-text-${terminalNum}`).textContent = 'Показать';
        } else {
            showError(result.message || `Не удалось остановить терминал ${terminalNum}`);
        }
    } catch (error) {
        console.error(`Ошибка остановки терминала ${terminalNum}:`, error);
        showError(`Ошибка остановки терминала ${terminalNum}: ${error.message}`);
    }
}

    // Dark mode toggle
    const darkToggle = document.getElementById("darkModeToggle");
    const darkToggleMobile = document.getElementById("darkModeToggleMobile");

    function setTheme(dark) {
        document.documentElement.classList.toggle("dark", dark);
        localStorage.setItem("theme", dark ? "dark" : "light");

        // Перемещаем "ползунок"
        const switches = [darkToggle, darkToggleMobile];
        switches.forEach(sw => {
            const knob = sw?.querySelector("div");
            knob?.classList.toggle("translate-x-full", dark);
        });
    }

    // Загружаем сохранённую тему
    const savedTheme = localStorage.getItem("theme");
    setTheme(savedTheme === "dark");

    // Переключение темы по нажатию
    darkToggle?.addEventListener("click", () => {
        setTheme(!document.documentElement.classList.contains("dark"));
    });
    darkToggleMobile?.addEventListener("click", () => {
        setTheme(!document.documentElement.classList.contains("dark"));
    });

    // Mobile menu toggle
    const mobileBtn = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    let isMobileOpen = false;

    mobileBtn?.addEventListener("click", () => {
        isMobileOpen = !isMobileOpen;
        mobileMenu.classList.toggle("pointer-events-none", !isMobileOpen);
        mobileMenu.classList.toggle("opacity-0", !isMobileOpen);
        mobileMenu.classList.toggle("scale-y-0", !isMobileOpen);
        mobileMenu.classList.toggle("scale-y-100", isMobileOpen);
    });

    
</script>
</body>
</html>
